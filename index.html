<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>數學冒險遊戲</title>
  <style>
    body {
      font-family: "Comic Sans MS", cursive, sans-serif;
      text-align: center;
      background: linear-gradient(to bottom right, #a8edea, #fed6e3);
      margin: 0;
      padding: 0;
    }
    #game {
      max-width: 600px;
      margin: 20px auto;
      padding: 20px;
      background: #fff;
      border-radius: 20px;
      box-shadow: 0 0 15px rgba(0,0,0,0.2);
    }
    .question {
      font-size: clamp(1.5em, 5vw, 2.5em);
      margin: 20px 0;
    }
    .input-area input {
      font-size: 1.5em;
      padding: 5px;
      width: 100px;
      text-align: center;
    }
    .btn {
      font-size: 1.2em;
      padding: 10px 20px;
      margin: 10px;
      cursor: pointer;
      border: none;
      border-radius: 10px;
      background: #ff9a9e;
      color: #fff;
      transition: background 0.3s;
    }
    .btn:hover {
      background: #f76c6c;
    }
    #feedback {
      margin-top: 15px;
      font-size: 1.2em;
      min-height: 30px;
    }
    #monster, #hero {
      font-size: 4em;
    }
    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <div id="game">
    <h1>數學冒險遊戲</h1>
    <div id="stats">
      等級: <span id="level">1</span> | 經驗: <span id="exp">0</span> | 連擊: <span id="streak">0</span>
    </div>
    <div class="question" id="question">點開始遊戲！</div>
    <div class="input-area">
      <input type="number" id="answer-input" disabled>
      <button id="answer-btn" class="btn" disabled>攻擊怪物</button>
    </div>
    <div id="feedback"></div>
    <div>
      <span id="hero">🧙‍♂️</span> VS <span id="monster">👾</span>
    </div>
    <button id="start-btn" class="btn">開始遊戲</button>
    <button id="restart-btn" class="btn hidden">重新開始</button>
  </div>

  <script>
    // 遊戲狀態集中管理
    const gameState = {
      level: 1,
      exp: 0,
      streak: 0,
      correctCount: 0,
      totalCount: 0,
      answered: false,
      started: false
    };

    let correctAnswer = 0;

    // DOM 快取
    const ui = {
      question: document.getElementById('question'),
      answerInput: document.getElementById('answer-input'),
      answerBtn: document.getElementById('answer-btn'),
      feedback: document.getElementById('feedback'),
      level: document.getElementById('level'),
      exp: document.getElementById('exp'),
      streak: document.getElementById('streak'),
      startBtn: document.getElementById('start-btn'),
      restartBtn: document.getElementById('restart-btn')
    };

    function startGame() {
      gameState.level = 1;
      gameState.exp = 0;
      gameState.streak = 0;
      gameState.correctCount = 0;
      gameState.totalCount = 0;
      gameState.started = true;
      ui.startBtn.classList.add('hidden');
      ui.restartBtn.classList.add('hidden');
      ui.answerInput.disabled = false;
      ui.answerBtn.disabled = false;
      updateStats();
      nextQuestion();
    }

    function endGame() {
      ui.question.textContent = "遊戲結束！你答對了 " + gameState.correctCount + " / " + gameState.totalCount + " 題";
      ui.feedback.textContent = "";
      ui.answerInput.disabled = true;
      ui.answerBtn.disabled = true;
      ui.restartBtn.classList.remove('hidden');
    }

    function nextQuestion() {
      const a = Math.floor(Math.random() * 9) + 1;
      const b = Math.floor(Math.random() * 9) + 1;
      correctAnswer = a * b;
      ui.question.textContent = `${a} × ${b} = ?`;
      ui.answerInput.value = "";
      ui.answerInput.focus();
      gameState.answered = false;
    }

    function checkAnswer() {
      if (gameState.answered) return;
      const ans = parseInt(ui.answerInput.value);
      if (isNaN(ans)) return;

      gameState.totalCount++;
      if (ans === correctAnswer) {
        gameState.correctCount++;
        gameState.exp += 10;
        gameState.streak++;
        ui.feedback.textContent = "✅ 答對了！";
      } else {
        gameState.streak = 0;
        ui.feedback.textContent = `❌ 答錯了！正確答案是 ${correctAnswer}`;
      }

      if (gameState.exp >= 100) {
        gameState.level++;
        gameState.exp = 0;
      }

      gameState.answered = true;
      updateStats();

      // 設定遊戲回合上限 (例如 10 題)
      if (gameState.totalCount >= 10) {
        setTimeout(endGame, 1200);
      } else {
        setTimeout(nextQuestion, 1200);
      }
    }

    function updateStats() {
      ui.level.textContent = gameState.level;
      ui.exp.textContent = gameState.exp;
      ui.streak.textContent = gameState.streak;
    }

    // 綁定事件
    ui.startBtn.addEventListener('click', startGame);
    ui.restartBtn.addEventListener('click', startGame);
    ui.answerBtn.addEventListener('click', checkAnswer);
    ui.answerInput.addEventListener('keydown', e => {
      if (e.key === 'Enter') checkAnswer();
    });
  </script>
</body>
</html>
